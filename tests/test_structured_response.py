"""
êµ¬ì¡°í™”ëœ ì‘ë‹µ í…ŒìŠ¤íŠ¸ - ë‹¤ì–‘í•œ ìì—°ì–´ í”„ë¡¬í”„íŠ¸ í•´ì„
"""

import sys
import os

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¥¼ Python ê²½ë¡œì— ì¶”ê°€
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), "..")))

from ai_server.services.llm_service import LLMService


def print_result(text: str, result: dict):
    """ê²°ê³¼ë¥¼ ë³´ê¸° ì¢‹ê²Œ ì¶œë ¥"""
    print(f"\n{'='*60}")
    print(f"ì…ë ¥: {text}")
    print(f"{'-'*60}")
    print(f"ğŸ¯ ì‘ì—… ìœ í˜•: {result['task_type']}")
    print(f"âœ“ ì‹ ë¢°ë„: {result['confidence']:.2f}")

    if result.get("fields"):
        print(f"ğŸ“‹ ì¶”ì¶œëœ í•„ë“œ:")
        for key, value in result["fields"].items():
            if value is not None:
                print(f"  - {key}: {value}")

    if result.get("error"):
        print(f"âŒ ì˜¤ë¥˜: {result['error']}")
    print(f"{'='*60}\n")


def test_all_scenarios():
    """ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸"""

    print("\n" + "=" * 60)
    print("êµ¬ì¡°í™”ëœ ì‘ë‹µ í…ŒìŠ¤íŠ¸ ì‹œì‘")
    print("=" * 60)

    # LLM ì„œë¹„ìŠ¤ ì´ˆê¸°í™”
    print("LLM ì„œë¹„ìŠ¤ ì´ˆê¸°í™” ì¤‘...")
    llm_service = LLMService()
    llm_service.initialize()
    print("ì´ˆê¸°í™” ì™„ë£Œ!\n")

    # í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë“¤
    test_cases = [
        # 1. ë¬¼í’ˆ/ê°„ì‹ ë°°ë‹¬ ê´€ë ¨
        "íšŒì˜ì‹¤ë¡œ ì»¤í”¼ ê°–ë‹¤ì¤˜",
        "301í˜¸ì— ì„œë¥˜ ì „ë‹¬í•´ì¤˜",
        "ë¡œë¹„ì—ì„œ ë°•ìŠ¤ ê°€ì ¸ì™€",
        "ê°„ì‹ ì°½ê³ ì—ì„œ ê³¼ì 2ê°œ ê°€ì ¸ì™€ì¤˜",
        # 2. ì•ˆë‚´/ì´ë™ ê´€ë ¨
        "ë°©ë¬¸ê°ì„ 3ì¸µ íšŒì˜ì‹¤ë¡œ ì•ˆë‚´í•´ì¤˜",
        "ë¡œë¹„ë¡œ ì´ë™í•´",
        "ë‚˜ë¥¼ ë”°ë¼ì™€",
        "ê¹€ì² ìˆ˜ì”¨ë¥¼ ë”°ë¼ê°€ì¤˜",
        # 3. ë¡œë´‡ ì œì–´ ê´€ë ¨
        "ì—¬ê¸°ë¡œ ì™€ì¤˜",
        "ì¶©ì „í•˜ëŸ¬ ê°€",
        "ì‘ì—… ì·¨ì†Œí•´",
        "ì ê¹ ë©ˆì¶°",
        "ë‹¤ì‹œ ì‹œì‘í•´",
        # 4. í™˜ê²½ ì œì–´ ê´€ë ¨ (IoT)
        "íšŒì˜ì‹¤ ë¶ˆ ì¼œì¤˜",
        "ì˜¨ë„ 25ë„ë¡œ ë§ì¶°ì¤˜",
        "ì—ì–´ì»¨ ì¼œì¤˜",
        "ë¬¸ ì ê°€ì¤˜",
        # 5. ì •ë³´ ì¡°íšŒ ê´€ë ¨
        "ë¡œë´‡ ìƒíƒœ ì–´ë•Œ?",
        "íšŒì˜ì‹¤ì´ ì–´ë””ì•¼?",
        "3ì¸µ íšŒì˜ì‹¤ ë¹„ì–´ìˆì–´?",
        "ë°•ì˜í¬ì”¨ ì–´ë””ìˆì–´?",
        "ë‚´ ë…¸íŠ¸ë¶ ì°¾ì•„ì¤˜",
        # 6. íšŒì˜ì‹¤ ê´€ë ¨
        "ì˜¤í›„ 2ì‹œì— íšŒì˜ì‹¤ ì˜ˆì•½í•´ì¤˜",
        "íšŒì˜ì‹¤ ì˜ˆì•½ ì·¨ì†Œí•´ì¤˜",
        "íšŒì˜ì‹¤ ì‚¬ìš© í˜„í™© ë³´ì—¬ì¤˜",
        # 7. ìˆœì°°/ëª¨ë‹ˆí„°ë§
        "2ì¸µ ì‚¬ë¬´ì‹¤ ìˆœì°°í•´ì¤˜",
        "í™˜ê²½ ìƒíƒœ ì²´í¬í•´ì¤˜",
        # 8. ê¸°íƒ€
        "ì•ˆë…•í•˜ì„¸ìš”",
        "ì˜¤ëŠ˜ ë‚ ì”¨ ì–´ë•Œ?",
    ]

    # ê° í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‹¤í–‰
    for i, text in enumerate(test_cases, 1):
        print(f"[í…ŒìŠ¤íŠ¸ {i}/{len(test_cases)}]")
        try:
            result = llm_service.parse_natural_language(text)
            print_result(text, result)
        except Exception as e:
            print(f"ì˜¤ë¥˜ ë°œìƒ: {e}")
            print()

    print("\n" + "=" * 60)
    print("ëª¨ë“  í…ŒìŠ¤íŠ¸ ì™„ë£Œ!")
    print("=" * 60)


if __name__ == "__main__":
    test_all_scenarios()
