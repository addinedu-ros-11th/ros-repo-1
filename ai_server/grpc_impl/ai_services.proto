syntax = "proto3";

package ai_inference;

// ============================================
// LLM Service (Qwen3-4B) - Port 50051
// ============================================
service LLMService {
  // 텍스트 생성
  rpc GenerateText (TextRequest) returns (TextResponse);
  
  // 대화형 응답
  rpc Chat (ChatRequest) returns (ChatResponse);
  
  // 의도 분석
  rpc AnalyzeIntent (TextRequest) returns (IntentResponse);
}

// ============================================
// Vision Service (YOLOv8n) - Port 50052
// ============================================
service VisionService {
  // 객체 인식
  rpc DetectObjects (ImageRequest) returns (ObjectDetectionResponse);
  
  // 얼굴 인식
  rpc RecognizeFaces (ImageRequest) returns (FaceRecognitionResponse);
  
  // 복수 객체 인식
  rpc DetectMultipleObjects (ImageRequest) returns (MultiObjectDetectionResponse);
  
  // 실시간 비전 스트리밍
  rpc StreamVisionResults (Empty) returns (stream VisionResult);
}

// ============================================
// LLM 메시지 정의
// ============================================

message TextRequest {
  string text = 1;
  int32 max_length = 2;
  optional float temperature = 3;
}

message TextResponse {
  string generated_text = 1;
  float confidence = 2;
}

message ChatRequest {
  repeated ChatMessage messages = 1;
  optional float temperature = 2;
}

message ChatMessage {
  string role = 1;  // "user", "assistant", "system"
  string content = 2;
}

message ChatResponse {
  string response = 1;
  float confidence = 2;
}

message IntentResponse {
  string intent = 1;
  float confidence = 2;
  repeated Entity entities = 3;
}

message Entity {
  string type = 1;
  string value = 2;
  float confidence = 3;
}

// ============================================
// Vision 메시지 정의
// ============================================

message Empty {}

message ImageRequest {
  string image_id = 1;
  optional bytes image_data = 2;  // 선택적으로 이미지 바이너리 직접 전송
}

message ObjectDetectionResponse {
  string object_name = 1;
  float confidence = 2;
  BoundingBox box = 3;
}

message BoundingBox {
  int32 x = 1;
  int32 y = 2;
  int32 width = 3;
  int32 height = 4;
}

message FaceRecognitionResponse {
  string person_type = 1;  // "Employee", "Guest", "Unknown"
  optional string employee_id = 2;
  float confidence = 3;
}

message MultiObjectDetectionResponse {
  repeated ObjectDetectionResponse objects = 1;
}

message VisionResult {
  string robot_id = 1;
  int64 timestamp = 2;
  oneof result {
    ObjectDetectionResponse object_detection = 3;
    FaceRecognitionResponse face_recognition = 4;
    MultiObjectDetectionResponse multi_objects = 5;
  }
}
